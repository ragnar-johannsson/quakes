function CanvasLayer(a){function b(a,b){return function(){b.apply(a)}}this.isAdded_=!1,this.isAnimated_=!1,this.paneName_=CanvasLayer.DEFAULT_PANE_NAME_,this.updateHandler_=null,this.resizeHandler_=null,this.topLeft_=null,this.centerListener_=null,this.resizeListener_=null,this.needsResize_=!0,this.requestAnimationFrameId_=null;var c=document.createElement("canvas");c.style.position="absolute",c.style.top=0,c.style.left=0,c.style.pointerEvents="none",this.canvas=c,this.repositionFunction_=b(this,this.repositionCanvas_),this.resizeFunction_=b(this,this.resize_),this.requestUpdateFunction_=b(this,this.update_),a&&this.setOptions(a)}jQuery.ajax=function(a){function b(a){return!e.test(a)&&/:\/\//.test(a)}var c=location.protocol,d=location.hostname,e=RegExp(c+"//"+d),f="http"+(/^https/.test(c)?"s":"")+"://query.yahooapis.com/v1/public/yql?callback=?",g='select * from html where url="{URL}" and xpath="*"';return function(c){var d=c.url;return/get/i.test(c.type)&&!/json/i.test(c.dataType)&&b(d)&&(c.url=f,c.dataType="json",c.data={q:g.replace("{URL}",d+(c.data?(/\?/.test(d)?"&":"?")+jQuery.param(c.data):"")),format:"xml"},!c.success&&c.complete&&(c.success=c.complete,delete c.complete),c.success=function(a){return function(b){a&&a.call(this,{responseText:(b.results[0]||"").replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi,"")},"success")}}(c.success)),a.apply(this,arguments)}}(jQuery.ajax),CanvasLayer.prototype=new google.maps.OverlayView,CanvasLayer.DEFAULT_PANE_NAME_="overlayLayer",CanvasLayer.CSS_TRANSFORM_=function(){for(var a=document.createElement("div"),b=["transform","WebkitTransform","MozTransform","OTransform","msTransform"],c=0;c<b.length;c++){var d=b[c];if(void 0!==a.style[d])return d}return b[0]}(),CanvasLayer.prototype.requestAnimFrame_=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){return window.setTimeout(a,1e3/60)},CanvasLayer.prototype.cancelAnimFrame_=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||function(){},CanvasLayer.prototype.setOptions=function(a){void 0!==a.animate&&this.setAnimate(a.animate),void 0!==a.paneName&&this.setPaneName(a.paneName),void 0!==a.updateHandler&&this.setUpdateHandler(a.updateHandler),void 0!==a.resizeHandler&&this.setResizeHandler(a.resizeHandler),void 0!==a.map&&this.setMap(a.map)},CanvasLayer.prototype.setAnimate=function(a){this.isAnimated_=!!a,this.isAnimated_&&this.scheduleUpdate()},CanvasLayer.prototype.isAnimated=function(){return this.isAnimated_},CanvasLayer.prototype.setPaneName=function(a){this.paneName_=a,this.setPane_()},CanvasLayer.prototype.getPaneName=function(){return this.paneName_},CanvasLayer.prototype.setPane_=function(){if(this.isAdded_){var a=this.getPanes();if(!a[this.paneName_])throw new Error('"'+this.paneName_+'" is not a valid MapPane name.');a[this.paneName_].appendChild(this.canvas)}},CanvasLayer.prototype.setResizeHandler=function(a){this.resizeHandler_=a},CanvasLayer.prototype.setUpdateHandler=function(a){this.updateHandler_=a},CanvasLayer.prototype.onAdd=function(){this.isAdded_||(this.isAdded_=!0,this.setPane_(),this.resizeListener_=google.maps.event.addListener(this.getMap(),"resize",this.resizeFunction_),this.centerListener_=google.maps.event.addListener(this.getMap(),"center_changed",this.repositionFunction_),this.resize_(),this.repositionCanvas_())},CanvasLayer.prototype.onRemove=function(){this.isAdded_&&(this.isAdded_=!1,this.topLeft_=null,this.canvas.parentElement.removeChild(this.canvas),this.centerListener_&&(google.maps.event.removeListener(this.centerListener_),this.centerListener_=null),this.resizeListener_&&(google.maps.event.removeListener(this.resizeListener_),this.resizeListener_=null),this.requestAnimationFrameId_&&(this.cancelAnimFrame_.call(window,this.requestAnimationFrameId_),this.requestAnimationFrameId_=null))},CanvasLayer.prototype.resize_=function(){if(this.isAdded_){var a=this.getMap(),b=a.getDiv().offsetWidth,c=a.getDiv().offsetHeight,d=this.canvas.width,e=this.canvas.height;(d!==b||e!==c)&&(this.canvas.width=b,this.canvas.height=c,this.canvas.style.width=b+"px",this.canvas.style.height=c+"px",this.needsResize_=!0,this.scheduleUpdate())}},CanvasLayer.prototype.draw=function(){this.repositionCanvas_()},CanvasLayer.prototype.repositionCanvas_=function(){var a=this.getMap().getBounds();this.topLeft_=new google.maps.LatLng(a.getNorthEast().lat(),a.getSouthWest().lng());var b=this.getProjection(),c=b.fromLatLngToDivPixel(this.topLeft_);this.canvas.style[CanvasLayer.CSS_TRANSFORM_]="translate("+Math.round(c.x)+"px,"+Math.round(c.y)+"px)",this.scheduleUpdate()},CanvasLayer.prototype.update_=function(){this.requestAnimationFrameId_=null,this.isAdded_&&(this.isAnimated_&&this.scheduleUpdate(),this.needsResize_&&this.resizeHandler_&&(this.needsResize_=!1,this.resizeHandler_()),this.updateHandler_&&this.updateHandler_())},CanvasLayer.prototype.getTopLeft=function(){return this.topLeft_},CanvasLayer.prototype.scheduleUpdate=function(){this.isAdded_&&!this.requestAnimationFrameId_&&(this.requestAnimationFrameId_=this.requestAnimFrame_.call(window,this.requestUpdateFunction_))},function(){var QuakeLayer={quakes:[],colors:[$.Color("rgba(0,0,255,0.5)"),$.Color("rgba(255,255,0,0.5)"),$.Color("rgba(255,0,0,0.5)")],initialize:function(a){var b=this,c={map:a,animate:!1,resizeHandler:function(){},updateHandler:function(){b.update()}};this.map=a,this.layer=new CanvasLayer(c),this.context=this.layer.canvas.getContext("2d"),this.getData()},update:function(){var a=this,b=this.layer.canvas.width,c=this.layer.canvas.height,d=this.map.getProjection(),e=function(b,c,d){a.context.fillStyle=a.getColor(d).toRgbaString(),a.context.beginPath(),a.context.arc(b.x,b.y,c/50,0,2*Math.PI,!1),a.context.fill(),a.context.lineWidth=.001,a.context.strokeStyle="#333333",a.context.stroke(),a.context.closePath()};this.context.clearRect(0,0,b,c),this.context.setTransform(1,0,0,1,0,0);var f=Math.pow(2,this.map.zoom);this.context.scale(f,f);var g=d.fromLatLngToPoint(this.layer.getTopLeft());this.context.translate(-g.x,-g.y),this.quakes.forEach(function(a,b,c){var f=parseFloat(a.lat.replace(",",".")),g=parseFloat(a.lon.replace(",",".")),h=parseFloat(a.s.replace(",",".")),i=new google.maps.LatLng(f,g),j=d.fromLatLngToPoint(i);e(j,h,b/c.length)})},getColor:function(a){0===a&&(a=1e-5);var b=a*(this.colors.length-1),c=this.colors[Math.ceil(b)-1],d=this.colors[Math.ceil(b)];return c.transition(d,b-Math.floor(b))},getData:function(){var that=this;$.get("http://www.vedur.is/skjalftar-og-eldgos/jardskjalftar").done(function(data){if(data&&1===data.results.length){var start=data.results[0].indexOf("VI.quakeInfo = [")+15,end=data.results[0].indexOf("]",start)+1;-1!==start&&(that.quakes=eval(data.results[0].substring(start,end)),that.update())}})}};$(document).ready(function(){var a=$("#map")[0],b=new google.maps.Map(a,{zoom:7,mapTypeControl:!1,center:new google.maps.LatLng(64.8167,-18.8167),mapTypeId:google.maps.MapTypeId.SATELLITE});QuakeLayer.initialize(b)})}();